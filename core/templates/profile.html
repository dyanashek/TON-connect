{% extends "base.html" %}
{% block content %}
    ПРОФИЛЬ
    <a href='https://oauth.telegram.org/auth?bot_id=6430717403&origin=https://ton-auth-dyanashek.amvera.io&return_to=https://ton-auth-dyanashek.amvera.io/profile'>Telegram</a>
    <button onclick="transaction()">pay TON</button>
    <button onclick="transactionUsdt()">pay USDT</button>
    <div id="ton-connect" style="backgroundcolor: black;"></div>
{% endblock %}
{% block js %}
<script>
    console.log(connector)

    const tonweb = new TonWeb(
        new TonWeb.HttpProvider("https://toncenter.com/api/v2/jsonRPC")
      );

    async function transaction() {
        const transaction = {
            validUntil: Math.round(Date.now() / 1000) + 100,
            messages: [
                {
                    address: '0:f8c8062b36e2d31082d1d40dfe16311eb6bdb2775b3080de66720363dda790c8',
                    amount: 1000000,
                }
            ]
        }
        try {
            await tonConnectUI.sendTransaction(transaction);
        } catch (error) {
            console.log('cancelled')
        }
    }

    async function transactionUsdt() {
        const transactionPayload = await createJettonTransferPayload('UQD4yAYrNuLTEILR1A3-FjEetr2yd1swgN5mcgNj3aeQyKAM', 0.1)
        console.log(transactionPayload)
        const transaction = {
            validUntil: Math.round(Date.now() / 1000) + 100,
            messages: [
                {
                    address: 'EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs',
                    amount: 500000, // Minimal amount of TON to cover fees
                    payload: transactionPayload, // Payload for Jetton transfer 
                }
            ]
        }
        try {
            await tonConnectUI.sendTransaction(transaction);
        } catch (error) {
            console.log('cancelled')
        }
    }

    async function createJettonTransferPayload(toAddress, amount) {
        const payloadCell = new tonweb.boc.Cell();
        payloadCell.bits.writeUint(0xf8a7ea5, 32); // Write query_id
        payloadCell.bits.writeUint(0, 64);
        payloadCell.bits.writeCoins(tonweb.utils.toNano(amount.toString())); // Convert USDT amount to Nano and write it
        payloadCell.bits.writeAddress(new tonweb.Address(toAddress)); // Write recipient address
        payloadCell.bits.writeAddress(
          new tonweb.Address(tonConnectUI.wallet.account.address)
        );
        payloadCell.bits.writeCoins(new tonweb.utils.BN(0)); // forward_ton_amount
        const boc = await payloadCell.toBoc()
        const bocSTR = btoa(String.fromCharCode(...new Uint8Array(boc)));
        console.log(bocSTR)
        return bocSTR
    }
    // te6cckEBAwEAnQABHCmpoxf/////AAAAAAADAQFoYgBYWVjjvdmacGmzShvSVmXI447mK+Iwd/RTV2YN4rCG3aAX14QAAAAAAAAAAAAAAAAAAQIApg+KfqUAAAAAAAAAADAYaggBG4qUOxqzbpcestwD4a5ebdXFAGUwiwJBmMq4bAIDnysAEOVCdywStGXFsXONMJaCQB8v4y/pdX/OJ2dPjsTBxqrAkqjOzA==
    // te6cckECFgEAArEAAgE0ARUBFP8A9KQT9LzyyAsCAgEgAw4CAUgEBQLc0CDXScEgkVuPYyDXCx8gghBleHRuvSGCEHNpbnS9sJJfA+CCEGV4dG66jrSAINchAdB01yH6QDD6RPgo+kQwWL2RW+DtRNCBAUHXIfQFgwf0Dm+hMZEw4YBA1yFwf9s84DEg10mBAoC5kTDgcOIREAIBIAYNAgEgBwoCAW4ICQAZrc52omhAIOuQ64X/wAAZrx32omhAEOuQ64WPwAIBSAsMABezJftRNBx1yHXCx+AAEbJi+1E0NcKAIAAZvl8PaiaECAoOuQ+gLAEC8g8BHiDXCx+CEHNpZ2668uCKfxAB5o7w7aLt+yGDCNciAoMI1yMggCDXIdMf0x/TH+1E0NIA0x8g0x/T/9cKAAr5AUDM+RCaKJRfCtsx4fLAh98Cs1AHsPLQhFEluvLghVA2uvLghvgju/LQiCKS+ADeAaR/yMoAyx8BzxbJ7VQgkvgP3nDbPNgRA/btou37AvQEIW6SbCGOTAIh1zkwcJQhxwCzji0B1yggdh5DbCDXScAI8uCTINdKwALy4JMg1x0GxxLCAFIwsPLQiddM1zkwAaTobBKEB7vy4JPXSsAA8uCT7VXi0gABwACRW+Dr1ywIFCCRcJYB1ywIHBLiUhCx4w8g10oSExQAlgH6QAH6RPgo+kQwWLry4JHtRNCBAUHXGPQFBJ1/yMoAQASDB/RT8uCLjhQDgwf0W/LgjCLXCgAhbgGzsPLQkOLIUAPPFhL0AMntVAByMNcsCCSOLSHy4JLSAO1E0NIAURO68tCPVFAwkTGcAYEBQNch1woA8uCO4sjKAFjPFsntVJPywI3iABCTW9sx4ddM0ABRgAAAAD///4iUDlQS5zKL114+bN6qGXvBroZlQ4Xt/tlEgF5ARkYszqBTsDOt
</script>
{% endblock %}

